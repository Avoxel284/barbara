{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/services/SoundCloud/index.ts"],"names":[],"mappings":";;;;;;AAMA,kDAA0B;AAC1B,mCAAgF;AAChF,6CAA0C;AAG7B,QAAA,sBAAsB,GAClC,0FAA0F,CAAC;AAKrF,KAAK,UAAU,eAAe,CAAC,GAAW;IAChD,IAAI,QAAQ,GAAG,MAAM,IAAA,eAAM,EAAC,qBAAqB,CAAC,CAAC;IAEnD,GAAG,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC;IACjB,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,8BAAsB,CAAC;QACrC,MAAM,IAAI,KAAK,CAAC,yCAAyC,CAAC,CAAC;IAC5D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,eAAK;SAC1B,GAAG,CAAC,6CAA6C,GAAG,cAAc,QAAQ,EAAE,CAAC;SAC7E,KAAK,CAAC,CAAC,GAAU,EAAE,EAAE;QACrB,MAAM,GAAG,CAAC;IACX,CAAC,CAAC,CAAC;IACJ,IAAI,IAAI,CAAC,UAAU,KAAK,KAAK;QAAE,MAAM,qCAAqC,CAAC;IAE3E,IAAI,IAAI,CAAC,IAAI,KAAK,OAAO,EAAE;QAC1B,OAAO,IAAA,gCAAwB,EAAC,IAAI,CAAC,CAAC;KACtC;IAED,IAAI,IAAI,CAAC,IAAI,KAAK,UAAU,EAAE;QAC7B,OAAO,IAAA,mCAA2B,EAAC,IAAI,CAAC,CAAC;KACzC;IAED,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;AAC1D,CAAC;AAtBD,0CAsBC;AASM,KAAK,UAAU,iBAAiB,CACtC,KAAa,EACb,QAAgB,EAAE,EAClB,OAA0C,QAAQ;IAElD,IAAI,QAAQ,GAAG,MAAM,IAAA,eAAM,EAAC,qBAAqB,CAAC,CAAC;IACnD,IAAI,CAAC,QAAQ;QAAE,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;IACnE,IAAI,CAAC,KAAK;QAAE,MAAM,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;IAC/C,IAAI,KAAK,GAAG,CAAC;QAAE,KAAK,GAAG,CAAC,CAAC;IAEzB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,eAAK;SAC1B,GAAG,CACH,wCAAwC,IAAI,MAAM,kBAAkB,CACnE,KAAK,CACL,cAAc,QAAQ,UAAU,KAAK,EAAE,CACxC;SACA,KAAK,CAAC,CAAC,GAAU,EAAE,EAAE;QACrB,MAAM,GAAG,CAAC;IACX,CAAC,CAAC,CAAC;IAEJ,IAAI,IAAI,KAAK,QAAQ,EAAE;QACtB,OAAO,IAAI,CAAC,UAAU;aACpB,MAAM,CAAC,CAAC,CAAM,EAAE,EAAE;YAClB,IAAI,CAAC,EAAE,kBAAkB,IAAI,CAAC,EAAE,kBAAkB,CAAC,QAAQ,CAAC,KAAK,CAAC;gBAAE,OAAO,KAAK,CAAC;YACjF,OAAO,IAAI,CAAC;QACb,CAAC,CAAC;aACD,GAAG,CAAC,CAAC,CAAM,EAAE,EAAE;YACf,OAAO,IAAA,gCAAwB,EAAC,CAAC,CAAC,CAAC;QACpC,CAAC,CAAC,CAAC;KACJ;IAED,IAAI,IAAI,KAAK,QAAQ,IAAI,IAAI,KAAK,WAAW,EAAE;QAC9C,OAAO,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAM,EAAE,EAAE,CAAC,IAAA,mCAA2B,EAAC,CAAC,CAAC,CAAC,CAAC;KACvE;IAED,MAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;AAC1D,CAAC;AApCD,8CAoCC;AAKD,SAAgB,mBAAmB,CAAC,GAAW;IAC9C,OAAO,GAAG,CAAC,KAAK,CAAC,8BAAsB,CAAC,CAAC;AAC1C,CAAC;AAFD,kDAEC","sourcesContent":["/**\r\n * Avoxel284 2022\r\n * Barbara Music Module / SoundCloud\r\n */\r\n\r\nimport { BarbaraType, MusicPlaylist, MusicTrack, Service } from \"../../lib\";\r\nimport axios from \"axios\";\r\nimport { MusicTrackFromSoundCloud, MusicPlaylistFromSoundCloud } from \"./parse\";\r\nimport { getKey } from \"../../lib/config\";\r\n\r\n/** URL pattern for SoundCloud - ripped from play-dl */\r\nexport const SOUNDCLOUD_URL_PATTERN =\r\n\t/^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?(api\\.soundcloud\\.com|soundcloud\\.com|snd\\.sc)\\/(.*)$/;\r\n\r\n/**\r\n * Returns {@link MusicTrack} or {@link MusicPlaylist} with data from SoundCloud from a given resource URL\r\n */\r\nexport async function SoundCloud_Info(url: string): Promise<MusicTrack | MusicPlaylist> {\r\n\tlet clientId = await getKey(\"SOUNDCLOUD_CLIENTID\");\r\n\r\n\turl = url.trim();\r\n\tif (!url.match(SOUNDCLOUD_URL_PATTERN))\r\n\t\tthrow new Error(`Given URL is not a valid SoundCloud URL`);\r\n\tconst { data } = await axios\r\n\t\t.get(`https://api-v2.soundcloud.com/resolve?url=${url}&client_id=${clientId}`)\r\n\t\t.catch((err: Error) => {\r\n\t\t\tthrow err;\r\n\t\t});\r\n\tif (data.streamable === false) throw \"SoundCloud track cannot be streamed\";\r\n\r\n\tif (data.kind === \"track\") {\r\n\t\treturn MusicTrackFromSoundCloud(data);\r\n\t}\r\n\r\n\tif (data.kind === \"playlist\") {\r\n\t\treturn MusicPlaylistFromSoundCloud(data);\r\n\t}\r\n\r\n\tthrow new Error(\"SoundCloud returned unknown resource.\");\r\n}\r\n\r\n/**\r\n * Searches for a SoundCloud track or playlist and returns with an array of {@link MusicTrack} or {@link MusicPlaylist}\r\n *\r\n * **Note:** Limit minimum is 5 since SoundCloud includes premium-only (Go+) tracks in searches.\r\n * Attempting to stream from such would result in a preview stream which would only last ~15 seconds.\r\n * Increasing the limit increases the chances of finding a non-premium track.\r\n */\r\nexport async function SoundCloud_Search(\r\n\tquery: string,\r\n\tlimit: number = 20,\r\n\ttype: \"tracks\" | \"playlists\" | \"albums\" = \"tracks\"\r\n): Promise<MusicTrack[] | MusicPlaylist[]> {\r\n\tlet clientId = await getKey(\"SOUNDCLOUD_CLIENTID\");\r\n\tif (!clientId) throw new Error(\"SoundCloud Client ID is not set!\");\r\n\tif (!query) throw new Error(\"No query given!\");\r\n\tif (limit < 5) limit = 5;\r\n\r\n\tconst { data } = await axios\r\n\t\t.get(\r\n\t\t\t`https://api-v2.soundcloud.com/search/${type}?q=${encodeURIComponent(\r\n\t\t\t\tquery\r\n\t\t\t)}&client_id=${clientId}&limit=${limit}`\r\n\t\t)\r\n\t\t.catch((err: Error) => {\r\n\t\t\tthrow err;\r\n\t\t});\r\n\r\n\tif (type === \"tracks\") {\r\n\t\treturn data.collection\r\n\t\t\t.filter((d: any) => {\r\n\t\t\t\tif (d?.monetization_model && d?.monetization_model.includes(\"SUB\")) return false;\r\n\t\t\t\treturn true;\r\n\t\t\t})\r\n\t\t\t.map((d: any) => {\r\n\t\t\t\treturn MusicTrackFromSoundCloud(d);\r\n\t\t\t});\r\n\t}\r\n\r\n\tif (type === \"albums\" || type === \"playlists\") {\r\n\t\treturn data.collection.map((d: any) => MusicPlaylistFromSoundCloud(d));\r\n\t}\r\n\r\n\tthrow new Error(\"SoundCloud returned unknown resource.\");\r\n}\r\n\r\n/**\r\n * Check a URL and validate if it is a SoundCloud URL\r\n */\r\nexport function SoundCloud_Validate(url: string) {\r\n\treturn url.match(SOUNDCLOUD_URL_PATTERN);\r\n}\r\n"]}