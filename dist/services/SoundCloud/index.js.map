{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/services/SoundCloud/index.ts"],"names":[],"mappings":"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","sourcesContent":["import { BarbaraType, MusicPlaylist, MusicTrack, Service } from \"../../classes\";\r\nimport axios from \"axios\";\r\nimport { MusicTrackFromSoundCloud, MusicPlaylistFromSoundCloud } from \"./parse\";\r\n\r\nlet clientId = \"\";\r\n\r\n/** URL pattern for SoundCloud - ripped from play-dl */\r\nconst SOUNDCLOUD_URL_PATTERN =\r\n\t/^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?(api\\.soundcloud\\.com|soundcloud\\.com|snd\\.sc)\\/(.*)$/;\r\n\r\n/**\r\n * Returns a free client ID - ripped from play-dl\r\n */\r\nexport async function getClientId(): Promise<string> {\r\n\tconst { data } = await axios.get(\"https://soundcloud.com/\").catch((err: Error) => {\r\n\t\tthrow err;\r\n\t});\r\n\tconst urls: string[] = [];\r\n\tdata.split('<script crossorigin src=\"').forEach((r: string) => {\r\n\t\tif (r.startsWith(\"https\")) urls.push(r.split('\"')[0]);\r\n\t});\r\n\tconst { data: data2 } = await axios.get(urls[urls.length - 1]).catch((err: Error) => {\r\n\t\tthrow err;\r\n\t});\r\n\treturn data2.split(',client_id:\"')[1].split('\"')[0];\r\n}\r\n\r\n/**\r\n * Returns MusicTrack or MusicPlaylist with information from SoundCloud\r\n */\r\nexport async function SoundCloud(url: string): Promise<MusicTrack | MusicPlaylist> {\r\n\tclientId = await getClientId();\r\n\tconsole.log(clientId);\r\n\r\n\turl = url.trim();\r\n\tif (!url.match(SOUNDCLOUD_URL_PATTERN))\r\n\t\tthrow new Error(`Given URL is not a valid SoundCloud URL`);\r\n\tconst { data } = await axios\r\n\t\t.get(`https://api-v2.soundcloud.com/resolve?url=${url}&client_id=${clientId}`)\r\n\t\t.catch((err: Error) => {\r\n\t\t\tthrow err;\r\n\t\t});\r\n\r\n\tif (data.kind === \"track\") return MusicTrackFromSoundCloud(data);\r\n\telse if (data.kind === \"playlist\") return MusicPlaylistFromSoundCloud(data);\r\n\telse throw new Error(\"SoundCloud returned unknown resource\");\r\n}\r\n\r\n/**\r\n * Searches for a SoundCloud track or playlist\r\n */\r\nexport async function SoundCloudSearch(\r\n\tquery: string,\r\n\tlimit: number,\r\n\ttype: \"tracks\" | \"playlists\" | \"albums\" = \"tracks\"\r\n): Promise<BarbaraType[]> {\r\n\tclientId = await getClientId();\r\n\tconsole.log(clientId);\r\n\r\n\tlet results: BarbaraType[] = [];\r\n\tconst { data } = await axios\r\n\t\t.get(\r\n\t\t\t`https://api-v2.soundcloud.com/search/${type}?q=${query}&client_id=${clientId}&limit=${limit}`\r\n\t\t)\r\n\t\t.catch((err: Error) => {\r\n\t\t\tthrow err;\r\n\t\t});\r\n\r\n\tif (type === \"tracks\")\r\n\t\tdata.collection.forEach((d: any) => results.push(MusicTrackFromSoundCloud(d)));\r\n\telse if (type === \"albums\" || type === \"playlists\")\r\n\t\tdata.collection.forEach((d: any) => results.push(MusicPlaylistFromSoundCloud(d)));\r\n\telse {\r\n\t\tthrow new Error(\"Unknown SoundCloud resource type\");\r\n\t}\r\n\r\n\treturn results;\r\n}\r\n\r\n// export async function SoundCloudStream(mt: MusicTrack) {\r\n// \tif (mt.service !== Service.soundcloud)\r\n// \t\tthrow Error(\"MusicTrack service is not SoundCloud, thus cannot be streamed\");\r\n\r\n// \tconst HLSformats = parseHlsFormats(data.formats);\r\n// \tif (typeof quality !== \"number\") quality = HLSformats.length - 1;\r\n// \telse if (quality <= 0) quality = 0;\r\n// \telse if (quality >= HLSformats.length) quality = HLSformats.length - 1;\r\n// \tconst req_url = HLSformats[quality].url + \"?client_id=\" + soundData.client_id;\r\n// \tconsole.log(req_url);\r\n// \tconst s_data = JSON.parse(await request(req_url));\r\n// \tconst type = HLSformats[quality].format.mime_type.startsWith(\"audio/ogg\")\r\n// \t\t? StreamType.OggOpus\r\n// \t\t: StreamType.Arbitrary;\r\n// \treturn new SoundCloudStream(s_data.url, type);\r\n// }\r\n"]}