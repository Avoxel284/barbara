{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/services/YouTube/index.ts"],"names":[],"mappings":";;;;;;AAMA,kDAA0B;AAC1B,mCAA0E;AAE1E,6CAA0C;AAE1C,MAAM,mBAAmB,GAAG,qCAAqC,CAAC;AAClE,MAAM,oBAAoB,GACzB,0IAA0I,CAAC;AAC5I,MAAM,iBAAiB,GACtB,gIAAgI,CAAC;AAK3H,KAAK,UAAU,YAAY,CAAC,GAAW;IAC7C,GAAG,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC;IAEjB,IAAI,OAAO,CAAC;IACZ,IAAI,GAAG,CAAC,QAAQ,CAAC,WAAW,CAAC;QAAE,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;SACpF,IAAI,GAAG,CAAC,QAAQ,CAAC,oBAAoB,CAAC;QAC1C,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;SAC/D,IAAI,GAAG,CAAC,QAAQ,CAAC,qBAAqB,CAAC;QAC3C,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;SAChE,IAAI,GAAG,CAAC,QAAQ,CAAC,4BAA4B,CAAC;QAClD,OAAO,GAAG,GAAG,CAAC,KAAK,CAAC,4BAA4B,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;;QACvE,OAAO,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,CAAC;IAEvF,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,eAAK,CAAC,GAAG,CAC7B,GAAG,IAAA,eAAM,EAAC,uBAAuB,CAAC,kBAAkB,OAAO,EAAE,CAC7D,CAAC;IAEF,OAAO,IAAA,6BAAqB,EAAC,IAAI,CAAC,CAAC;AACpC,CAAC;AAlBD,oCAkBC;AAMM,KAAK,UAAU,cAAc,CACnC,KAAa,EACb,QAAgB,EAAE,EAClB,OAA6B,OAAO;IAEpC,IAAI,EAAE,IAAI,EAAE,GAAG,MAAM,eAAK,CAAC,GAAG,CAC7B,GAAG,IAAA,eAAM,EAAC,uBAAuB,CAAC,oBAAoB,kBAAkB,CACvE,KAAK,CACL,SAAS,IAAI,EAAE,CAChB,CAAC;IAEF,OAAO,IAAI,CAAC,GAAG,CAAC,6BAAqB,CAAC,CAAC;AACxC,CAAC;AAZD,wCAYC;AAKD,SAAgB,gBAAgB,CAAC,GAAW;IAC3C,IAAI,GAAG,CAAC,KAAK,CAAC,oBAAoB,CAAC;QAAE,OAAO,IAAI,CAAC;IACjD,IAAI,GAAG,CAAC,KAAK,CAAC,iBAAiB,CAAC;QAAE,OAAO,IAAI,CAAC;AAC/C,CAAC;AAHD,4CAGC","sourcesContent":["/**\n * Avoxel284 2022\n * Barbara Music Module / YouTube\n */\n\nimport { BarbaraType, MusicPlaylist, MusicTrack, Service } from \"../../lib\";\nimport axios from \"axios\";\nimport { MusicPlaylistFromYouTube, MusicTrackFromYouTube } from \"./parse\";\nimport { debugLog } from \"../../lib/util\";\nimport { getKey } from \"../../lib/config\";\n\nconst PLAYLIST_ID_PATTERN = /^(PL|UU|LL|RD|OL)[a-zA-Z\\d_-]{10,}$/;\nconst PLAYLIST_URL_PATTERN =\n\t/^((?:https?:)?\\/\\/)?(?:(?:www|m|music)\\.)?(youtube\\.com)\\/(?:(playlist|watch))(.*)?((\\?|\\&)list=)(PL|UU|LL|RD|OL)[a-zA-Z\\d_-]{10,}(.*)?$/;\nconst VIDEO_URL_PATTERN =\n\t/^((?:https?:)?\\/\\/)?(?:(?:www|m|music)\\.)?((?:youtube\\.com|youtu.be))(\\/(?:[\\w\\-]+\\?v=|shorts\\/|embed\\/|v\\/)?)([\\w\\-]+)(\\S+)?$/;\n\n/**\n * Returns {@link MusicTrack} or {@link MusicPlaylist} from a given YouTube URL\n */\nexport async function YouTube_Info(url: string): Promise<MusicTrack | MusicPlaylist> {\n\turl = url.trim();\n\n\tlet videoId;\n\tif (url.includes(\"youtu.be/\")) videoId = url.split(\"youtu.be/\")[1].split(/(\\?|\\/|&)/)[0];\n\telse if (url.includes(\"youtube.com/embed/\"))\n\t\tvideoId = url.split(\"youtube.com/embed/\")[1].split(/(\\?|\\/|&)/)[0];\n\telse if (url.includes(\"youtube.com/shorts/\"))\n\t\tvideoId = url.split(\"youtube.com/shorts/\")[1].split(/(\\?|\\/|&)/)[0];\n\telse if (url.includes(\"youtube.com/playlist?list=\"))\n\t\tvideoId = url.split(\"youtube.com/playlist?list=\")[1].split(/(\\?|\\/|&)/)[0];\n\telse videoId = (url.split(\"watch?v=\")[1] ?? url.split(\"&v=\")[1]).split(/(\\?|\\/|&)/)[0];\n\n\tlet { data } = await axios.get(\n\t\t`${getKey(\"YOUTUBE_INVIDIOUSSITE\")}/api/v1/videos/${videoId}`\n\t);\n\n\treturn MusicTrackFromYouTube(data);\n}\n\n/**\n * Searches for a YouTube video or playlist and returns an array of {@link MusicTrack} or {@link MusicPlaylist}\n * Some code was ripped from play-dl\n */\nexport async function YouTube_Search(\n\tquery: string,\n\tlimit: number = 10,\n\ttype: \"video\" | \"playlist\" = \"video\"\n): Promise<MusicTrack[] | MusicPlaylist[]> {\n\tlet { data } = await axios.get(\n\t\t`${getKey(\"YOUTUBE_INVIDIOUSSITE\")}/api/v1/search?q=${encodeURIComponent(\n\t\t\tquery\n\t\t)}&type=${type}`\n\t);\n\n\treturn data.map(MusicTrackFromYouTube);\n}\n\n/**\n * Check a URL and validate if it is a YouTube URL\n */\nexport function YouTube_Validate(url: string) {\n\tif (url.match(PLAYLIST_URL_PATTERN)) return true;\n\tif (url.match(VIDEO_URL_PATTERN)) return true;\n}"]}